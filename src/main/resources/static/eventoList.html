<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="Description" content="Lista de eventos creados por Zénit Eventos"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.1.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="./css/admin.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap" rel="stylesheet">
    <title>Zénit Eventos - Lista de Eventos</title>
    <style>
        .event-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 40px;
            background-color: #ffffff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            color: #333;
            transition: transform 0.2s;
        }
        .event-card:hover {
            transform: translateY(-5px);
        }
        .event-card h5 { margin-bottom: 10px; font-weight: bold; }
        .event-card p { margin: 5px 0; }
        .event-card .event-image {
            max-width: 100%;
            height: auto;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        .event-card .no-image {
            color: #666;
            font-style: italic;
            margin-bottom: 10px;
        }
        .event-card .actions { margin-top: 10px; }
        #eventsContainer {
            margin-top: 20px;
            row-gap: 30px;
            --bs-gutter-x: 3rem;
        }
        .modal-body {
            padding: 20px;
        }
        .invitados-container, .locations-container {
            margin-bottom: 15px;
        }
        .invitado-field, .location-field {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .invitado-field select, .location-field input {
            flex-grow: 1;
            margin-right: 10px;
        }
        .upload-section {
            margin-top: 15px;
            text-align: center;
        }
        #imagePreview img {
            max-width: 200px;
            max-height: 200px;
            border-radius: 10px;
            margin-top: 10px;
        }
        .admin-create__label {
            font-weight: bold;
            margin-bottom: 5px;
            display: block;
			color:black;
        }
        .admin-create__input {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .custom__button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .custom__button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header__logo">
            <a href="./index.html"><img src="./img/logo1.png" alt="LogoZénit"></a>
            <span class="header__title">Zenit Eventos</span>
            <nav class="header__navbar">
                <a href="/organizador.html" class="navbar__links navbar__links--activo">Organizador</a>
                <a href="/index.html" class="navbar__links">Cerrar Sesión</a>
            </nav>
        </div>
    </header>

    <main class="contenedor">
        <div class="admin-list">
            <h2 class="admin-list__title">Lista de Eventos Creados</h2>
            <div id="eventsContainer" class="row g-5">
                <!-- Tarjetas se cargarán dinámicamente con JavaScript -->
            </div>
        </div>
    </main>

    <!-- Modal para editar evento -->
	<div class="modal fade" id="editEventModal" tabindex="-1" aria-labelledby="editEventModalLabel" aria-hidden="true">
	    <div class="modal-dialog modal-lg">
	        <div class="modal-content">
	            <div class="modal-header">
	                <h5 class="modal-title" id="editEventModalLabel">Editar Evento</h5>
	                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	            </div>
	            <div class="modal-body">
	                <form id="editEventForm" enctype="multipart/form-data">
	                    <fieldset>
	                        <legend class="admin-create__title">Editar Evento</legend>

	                        <input type="hidden" id="editEventId" name="id">

	                        <label for="editOrganizadorId" class="admin-create__label">ID del Organizador <i class="fa-solid fa-user"></i></label>
	                        <input type="text" class="admin-create__input" id="editOrganizadorId" name="organizadorId" readonly>

	                        <label for="editOrganizadorNombre" class="admin-create__label">Nombre del Organizador <i class="fa-solid fa-user"></i></label>
	                        <input type="text" class="admin-create__input" id="editOrganizadorNombre" name="organizadorNombre" readonly>

	                        <label for="editNombreEvento" class="admin-create__label">Nombre del Evento <i class="fa-solid fa-calendar-days"></i></label>
	                        <input type="text" class="admin-create__input" id="editNombreEvento" name="nombreEvento" required>

	                        <label for="editFecha" class="admin-create__label">Fecha <i class="fa-solid fa-calendar"></i></label>
	                        <input type="date" class="admin-create__input" id="editFecha" name="fecha" required>

	                        <label class="admin-create__label">Invitados <i class="fa-solid fa-user-friends"></i></label>
	                        <div class="invitados-container" id="editInvitadosContainer">
	                            <div class="invitado-fields">
	                                <div class="invitado-field">
	                                    <select class="admin-create__input invitado-select" required>
	                                        <option value="" disabled selected>Selecciona un invitado</option>
	                                    </select>
	                                    <button type="button" class="btn btn-danger btn-sm remove-invitado" style="display: none;">X</button>
	                                </div>
	                            </div>
	                            <button type="button" class="add-invitado">Agregar otro invitado</button>
	                        </div>

	                        <label for="editCantidadSillas" class="admin-create__label">Cantidad de Sillas <i class="fa-solid fa-chair"></i></label>
	                        <input type="number" class="admin-create__input" id="editCantidadSillas" name="cantidadSillas" required>

	                        <label class="admin-create__label">Proveedores <i class="fa-solid fa-truck"></i></label>
	                        <div id="editProveedoresContainer">
	                            <div>
	                                <label for="editProveedorSonidoeIluminación" class="admin-create__label">Sonido e Iluminación</label>
	                                <select id="editProveedorSonidoeIluminación" class="admin-create__input">
	                                    <option value="" disabled selected>Selecciona un proveedor</option>
	                                </select>
	                            </div>
	                            <div>
	                                <label for="editProveedorDecoración" class="admin-create__label">Decoración</label>
	                                <select id="editProveedorDecoración" class="admin-create__input">
	                                    <option value="" disabled selected>Selecciona un proveedor</option>
	                                </select>
	                            </div>
	                            <div>
	                                <label for="editProveedorLogística" class="admin-create__label">Logística</label>
	                                <select id="editProveedorLogística" class="admin-create__input">
	                                    <option value="" disabled selected>Selecciona un proveedor</option>
	                                </select>
	                            </div>
	                            <div>
	                                <label for="editProveedorServicioPersonal" class="admin-create__label">Servicio Personal</label>
	                                <select id="editProveedorServicioPersonal" class="admin-create__input">
	                                    <option value="" disabled selected>Selecciona un proveedor</option>
	                                </select>
	                            </div>
	                            <div>
	                                <label for="editProveedorTaquillería" class="admin-create__label">Taquillería</label>
	                                <select id="editProveedorTaquillería" class="admin-create__input">
	                                    <option value="" disabled selected>Selecciona un proveedor</option>
	                                </select>
	                            </div>
	                            <div>
	                                <label for="editProveedorAlimentación" class="admin-create__label">Alimentación</label>
	                                <select id="editProveedorAlimentación" class="admin-create__input">
	                                    <option value="" disabled selected>Selecciona un proveedor</option>
	                                </select>
	                            </div>
	                            <div>
	                                <label for="editProveedorMarketing" class="admin-create__label">Marketing</label>
	                                <select id="editProveedorMarketing" class="admin-create__input">
	                                    <option value="" disabled selected>Selecciona un proveedor</option>
	                                </select>
	                            </div>
	                        </div>

	                        <label for="editLugar" class="admin-create__label">Lugar General <i class="fa-solid fa-map-marker-alt"></i></label>
	                        <input type="text" class="admin-create__input" id="editLugar" name="lugar" required>

	                        <label for="editHora" class="admin-create__label">Hora <i class="fa-solid fa-clock"></i></label>
	                        <input type="time" class="admin-create__input" id="editHora" name="hora" required>

	                        <label for="editCiudad" class="admin-create__label">Ciudad <i class="fa-solid fa-city"></i></label>
	                        <input type="text" class="admin-create__input" id="editCiudad" name="ciudad" required>

	                        <label class="admin-create__label">Ubicaciones y Precios <i class="fa-solid fa-money-bill-wave"></i></label>
	                        <div class="locations-container" id="editLocationsContainer">
	                            <div class="location-fields">
	                                <div class="location-field">
	                                    <input type="text" class="admin-create__input location-name" placeholder="Nombre de la ubicación" required>
	                                    <input type="number" class="admin-create__input location-price" placeholder="Precio ($)" required>
	                                    <button type="button" class="btn btn-danger btn-sm remove-location" style="display: none;">X</button>
	                                </div>
	                            </div>
	                            <button type="button" class="add-location">Agregar otra ubicación</button>
	                        </div>

	                        <label for="editDescripcion" class="admin-create__label">Descripción <i class="fa-solid fa-file-alt"></i></label>
	                        <textarea class="admin-create__input" id="editDescripcion" name="descripcion" required></textarea>

	                        <label for="editRequisitos" class="admin-create__label">Requisitos <i class="fa-solid fa-exclamation-circle"></i></label>
	                        <textarea class="admin-create__input" id="editRequisitos" name="requisitos" required></textarea>

	                        <label for="editEstadoAprobacion" class="admin-create__label">Estado de Aprobación <i class="fa-solid fa-check-circle"></i></label>
	                        <input type="text" class="admin-create__input" id="editEstadoAprobacion" name="estadoAprobacion" readonly>

	                        <button class="custom__button" type="submit">Guardar Cambios <i class="fa-solid fa-save"></i></button>
	                    </fieldset>
	                </form>
	            </div>
	        </div>
	    </div>
	</div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.9.2/umd/popper.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.1.0/js/bootstrap.min.js"></script>
    <script src="https://kit.fontawesome.com/962fcf7572.js" crossorigin="anonymous"></script>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script>
        let invitadosMap = {};
        let proveedoresMap = {};
        let invitadoTemplate = null;
        let locationTemplate = null;

        async function loadResources() {
            try {
                const invitadosResponse = await fetch('/rest/invitados', {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                });
                if (!invitadosResponse.ok) throw new Error('Error al cargar invitados');
                const invitados = await invitadosResponse.json();
                invitados.forEach(invitado => {
                    invitadosMap[invitado.id] = invitado.nombre;
                });

                const proveedoresResponse = await fetch('/rest/proveedores', {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                });
                if (!proveedoresResponse.ok) throw new Error('Error al cargar proveedores');
                const proveedores = await proveedoresResponse.json();
                proveedores.forEach(proveedor => {
                    proveedoresMap[proveedor.id] = proveedor.nombre;
                });
            } catch (error) {
                console.error('Error al cargar recursos:', error);
            }
        }

        async function loadInvitados(containerId = 'editInvitadosContainer') {
            try {
                const response = await fetch('/rest/invitados', {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                });
                if (!response.ok) throw new Error('Error al cargar invitados');
                const invitados = await response.json();
                const container = document.getElementById(containerId);
                if (!container) return;
                const selects = container.querySelectorAll('.invitado-select');
                if (selects.length === 0) return;
                invitadoTemplate = selects[0].cloneNode(true);
                selects.forEach(select => {
                    const currentValue = select.value;
                    select.innerHTML = '<option value="" disabled>Selecciona un invitado</option>';
                    invitados.forEach(invitado => {
                        const option = document.createElement('option');
                        option.value = invitado.id;
                        option.textContent = invitado.nombre || 'Sin nombre';
                        select.appendChild(option);
                    });
                    if (currentValue) select.value = currentValue;
                });
            } catch (error) {
                console.error('Error al cargar invitados:', error);
                alert('Error al cargar invitados: ' + error.message);
            }
        }

        async function loadProveedores(containerId = 'editProveedoresContainer') {
            const categorias = ['Sonido e Iluminación', 'Decoración', 'Logística', 'Servicio Personal', 'Taquillería', 'Alimentación', 'Marketing'];
            for (const categoria of categorias) {
                try {
                    const response = await fetch(`/rest/proveedores/categoria/${encodeURIComponent(categoria)}`, {
                        method: 'GET',
                        headers: { 'Content-Type': 'application/json' },
                        credentials: 'include',
                    });
                    if (!response.ok) throw new Error(`Error al cargar proveedores de ${categoria}`);
                    const proveedores = await response.json();
                    const selectId = `editProveedor${categoria.replace(/\s/g, '')}`;
                    const select = document.getElementById(selectId);
                    if (!select) continue;
                    const currentValue = select.value;
                    select.innerHTML = '<option value="" disabled selected>Selecciona un proveedor</option>';
                    proveedores.forEach(proveedor => {
                        const option = document.createElement('option');
                        option.value = proveedor.id;
                        option.textContent = proveedor.nombre || 'Sin nombre';
                        select.appendChild(option);
                    });
                    if (currentValue) select.value = currentValue;
                } catch (error) {
                    console.error(`Error al cargar proveedores de ${categoria}:`, error);
                    alert(`Error al cargar proveedores de ${categoria}: ${error.message}`);
                }
            }
        }

        function addInvitadoField() {
            const container = document.querySelector('#editInvitadosContainer .invitado-fields');
            if (!container) return;
            const newSelect = invitadoTemplate.cloneNode(true);
            newSelect.classList.add('invitado-select');
            const removeButton = document.createElement('button');
            removeButton.type = 'button';
            removeButton.className = 'btn btn-danger btn-sm remove-invitado';
            removeButton.textContent = 'X';
            removeButton.style.display = 'inline';
            removeButton.addEventListener('click', function() {
                this.parentElement.remove();
            });
            const newField = document.createElement('div');
            newField.className = 'invitado-field';
            newField.appendChild(newSelect);
            newField.appendChild(removeButton);
            container.appendChild(newField);
            loadInvitados();
        }

        function addLocationField() {
            const container = document.querySelector('#editLocationsContainer .location-fields');
            if (!container) return;
            const newLocation = locationTemplate.cloneNode(true);
            const removeButton = newLocation.querySelector('.remove-location');
            removeButton.style.display = 'inline';
            removeButton.addEventListener('click', function() {
                this.parentElement.remove();
            });
            container.appendChild(newLocation);
        }

		async function loadEvents() {
		    const eventsContainer = document.getElementById('eventsContainer');
		    eventsContainer.innerHTML = '';

		    try {
		        const response = await fetch('/rest/organizadores/eventos', {
		            method: 'GET',
		            headers: { 'Content-Type': 'application/json' },
		            credentials: 'include',
		        });

		        if (!response.ok) {
		            if (response.status === 401) throw new Error('No estás autenticado. Por favor, inicia sesión.');
		            if (response.status === 404) throw new Error('No se encontraron eventos para este organizador.');
		            throw new Error(`Error al obtener eventos: ${response.status} - ${response.statusText}`);
		        }

		        const events = await response.json();
		        console.log('Eventos obtenidos:', events); // Depuración

		        if (!Array.isArray(events)) throw new Error('La respuesta no es una lista de eventos');

		        if (events.length === 0) {
		            eventsContainer.innerHTML = '<p class="text-center">No hay eventos creados todavía.</p>';
		            return;
		        }

		        events.forEach(event => {
		            const invitadosNombres = event.invitados
		                ? event.invitados.map(id => invitadosMap[id] || id).join(', ')
		                : 'N/A';
		            const proveedoresNombres = event.proveedores
		                ? Object.entries(event.proveedores).map(([key, id]) => `${key}: ${proveedoresMap[id] || id}`).join(', ')
		                : 'N/A';
		            const card = document.createElement('div');
		            card.classList.add('col-md-4', 'event-card');
		            let imageContent = '';
		            const timestamp = new Date().getTime();
		            if (event.imagenUrl && event.imagenUrl.trim() !== '') {
		                const fullImageUrl = `${window.location.origin}${event.imagenUrl}?t=${timestamp}`;
		                console.log(`Intentando cargar imagen para ${event.nombreEvento}: ${fullImageUrl}`);
		                imageContent = `<img src="${fullImageUrl}" alt="${event.nombreEvento || 'Imagen del evento'}" class="event-image" onerror="this.style.display='none'; this.parentElement.innerHTML='<p class=\\'no-image\\'>No se pudo cargar la imagen</p>'; console.log('Error al cargar imagen para ${event.nombreEvento}:', this.src);">`;
		            } else {
		                imageContent = '<p class="no-image">No posee imagen</p>';
		            }
		            card.innerHTML = `
		                ${imageContent}
		                <h5>${event.nombreEvento || 'N/A'}</h5>
		                <p><strong>Fecha:</strong> ${event.fecha || 'N/A'}</p>
		                <p><strong>Lugar:</strong> ${event.lugar || 'N/A'}</p>
		                <p><strong>Organizador:</strong> ${event.organizadorNombre || 'N/A'}</p>
		                <p><strong>Invitados:</strong> ${invitadosNombres}</p>
		                <p><strong>Proveedores:</strong> ${proveedoresNombres}</p>
		                <p><strong>Estado:</strong> ${event.estadoAprobacion || 'N/A'}</p>
		                <div class="actions">
		                    <button class="admin-list__action-btn admin-list__action-btn--edit" data-id="${event.id}" data-bs-toggle="modal" data-bs-target="#editEventModal">
		                        <i class="fas fa-edit"></i> Editar
		                    </button>
		                    <button class="admin-list__action-btn admin-list__action-btn--delete" data-id="${event.id}">
		                        <i class="fas fa-trash-alt"></i> Eliminar
		                    </button>
		                </div>
		            `;
		            eventsContainer.appendChild(card);
		        });

		        document.querySelectorAll('.admin-list__action-btn--edit').forEach(btn => {
		            btn.addEventListener('click', () => {
		                const id = btn.dataset.id;
		                loadEventForEdit(id);
		            });
		        });
		        document.querySelectorAll('.admin-list__action-btn--delete').forEach(btn => {
		            btn.addEventListener('click', () => deleteEvent(btn.dataset.id));
		        });

		    } catch (error) {
		        console.error('Error al cargar eventos:', error);
		        eventsContainer.innerHTML = '<p class="text-center">Error al cargar eventos. Intenta de nuevo más tarde. Detalle: ' + error.message + '</p>';
		    }
		}

		async function loadEventForEdit(id) {
		    try {
		        const response = await fetch(`/rest/organizadores/eventos/${id}`, {
		            method: 'GET',
		            headers: { 'Content-Type': 'application/json' },
		            credentials: 'include',
		        });

		        if (!response.ok) throw new Error(`Error al obtener evento: ${response.statusText}`);

		        const event = await response.json();

		        document.getElementById('editEventId').value = event.id;
		        document.getElementById('editOrganizadorId').value = event.organizadorId || '';
		        document.getElementById('editOrganizadorNombre').value = event.organizadorNombre || '';
		        document.getElementById('editNombreEvento').value = event.nombreEvento || '';
		        document.getElementById('editFecha').value = event.fecha || '';
		        document.getElementById('editCantidadSillas').value = event.cantidadSillas || '';
		        document.getElementById('editLugar').value = event.lugar || '';
		        document.getElementById('editHora').value = event.hora || '';
		        document.getElementById('editCiudad').value = event.ciudad || '';
		        document.getElementById('editDescripcion').value = event.descripcion || '';
		        document.getElementById('editRequisitos').value = event.requisitos || '';
		        document.getElementById('editEstadoAprobacion').value = event.estadoAprobacion || '';

		        // Cargar invitados
		        const invitadosContainer = document.querySelector('#editInvitadosContainer .invitado-fields');
		        invitadosContainer.innerHTML = ''; // Limpiar el contenedor

		        if (event.invitados && event.invitados.length > 0) {
		            event.invitados.forEach((invitadoId, index) => {
		                const field = document.createElement('div');
		                field.className = 'invitado-field';
		                field.innerHTML = `
		                    <select class="admin-create__input invitado-select" required>
		                        <option value="" disabled>Selecciona un invitado</option>
		                    </select>
		                    <button type="button" class="btn btn-danger btn-sm remove-invitado" style="display: ${index === 0 ? 'none' : 'inline'};">X</button>
		                `;
		                const select = field.querySelector('.invitado-select');
		                select.value = invitadoId || ''; // Asegura que el valor sea correcto
		                field.querySelector('.remove-invitado').addEventListener('click', function() {
		                    this.parentElement.remove();
		                });
		                invitadosContainer.appendChild(field);
		            });
		        } else {
		            // Si no hay invitados, no agregar un campo por defecto
		            // El usuario puede agregar uno usando el botón "Agregar otro invitado"
		            invitadosContainer.innerHTML = ''; // Simplemente dejar vacío
		        }

		        await loadInvitados(); // Recargar opciones de invitados

		        // Cargar proveedores
		        await loadProveedores();
		        if (event.proveedores) {
		            Object.entries(event.proveedores).forEach(([categoria, id]) => {
		                const selectId = `editProveedor${categoria.replace(/\s/g, '')}`;
		                const select = document.getElementById(selectId);
		                if (select) select.value = id || '';
		            });
		        }

		        // Cargar ubicaciones y precios
		        const locationsContainer = document.querySelector('#editLocationsContainer .location-fields');
		        locationsContainer.innerHTML = '';
		        if (event.ubicacionesPrecios && event.ubicacionesPrecios.length > 0) {
		            event.ubicacionesPrecios.forEach((loc, index) => {
		                const field = document.createElement('div');
		                field.className = 'location-field';
		                field.innerHTML = `
		                    <input type="text" class="admin-create__input location-name" placeholder="Nombre de la ubicación" value="${loc.ubicacion}" required>
		                    <input type="number" class="admin-create__input location-price" placeholder="Precio ($)" value="${loc.precio}" required>
		                    <button type="button" class="btn btn-danger btn-sm remove-location" style="display: ${index === 0 ? 'none' : 'inline'};">X</button>
		                `;
		                field.querySelector('.remove-location').addEventListener('click', function() {
		                    this.parentElement.remove();
		                });
		                locationsContainer.appendChild(field);
		            });
		        } else {
		            const field = document.createElement('div');
		            field.className = 'location-field';
		            field.innerHTML = `
		                <input type="text" class="admin-create__input location-name" placeholder="Nombre de la ubicación" required>
		                <input type="number" class="admin-create__input location-price" placeholder="Precio ($)" required>
		                <button type="button" class="btn btn-danger btn-sm remove-location" style="display: none;">X</button>
		            `;
		            locationsContainer.appendChild(field);
		        }
		        locationTemplate = locationsContainer.querySelector('.location-field').cloneNode(true);

		    } catch (error) {
		        console.error('Error al cargar evento para edición:', error);
		        alert('Error al cargar evento para edición: ' + error.message);
		    }
		}

		document.getElementById('editEventForm').addEventListener('submit', async function(event) {
		    event.preventDefault();

		    const formData = new FormData(this); // Usar 'this' para referirse al formulario
		    const eventData = {
		        nombreEvento: document.getElementById('editNombreEvento').value,
		        fecha: document.getElementById('editFecha').value,
		        lugar: document.getElementById('editLugar').value,
		        hora: document.getElementById('editHora').value,
		        ciudad: document.getElementById('editCiudad').value,
		        cantidadSillas: parseInt(document.getElementById('editCantidadSillas').value),
		        descripcion: document.getElementById('editDescripcion').value,
		        requisitos: document.getElementById('editRequisitos').value,
		        estadoAprobacion: document.getElementById('editEstadoAprobacion').value,
		        invitados: Array.from(document.querySelectorAll('#editInvitadosContainer .invitado-select')).map(select => select.value),
		        proveedores: {
		            'Sonido e Iluminación': document.getElementById('editProveedorSonidoeIluminación').value,
		            'Decoración': document.getElementById('editProveedorDecoración').value,
		            'Logística': document.getElementById('editProveedorLogística').value,
		            'Servicio Personal': document.getElementById('editProveedorServicioPersonal').value,
		            'Taquillería': document.getElementById('editProveedorTaquillería').value,
		            'Alimentación': document.getElementById('editProveedorAlimentación').value,
		            'Marketing': document.getElementById('editProveedorMarketing').value
		        },
		        ubicacionesPrecios: Array.from(document.querySelectorAll('.location-field')).map(field => ({
		            ubicacion: field.querySelector('.location-name').value,
		            precio: parseFloat(field.querySelector('.location-price').value)
		        }))
		    };

		    const id = document.getElementById('editEventId').value;

		    try {
		        console.log('Enviando datos para actualizar el evento con ID:', id); // Depuración
		        const response = await fetch(`/rest/organizadores/eventos/${id}`, {
		            method: 'PUT',
		            headers: {
		                'Content-Type': 'application/json'
		            },
		            credentials: 'include',
		            body: JSON.stringify(eventData)
		        });

		        if (!response.ok) throw new Error('Error al actualizar el evento');

		        const updatedEvent = await response.json();
		        console.log('Evento actualizado:', updatedEvent); // Depuración
		        alert('Evento actualizado con éxito');
		        // Usar jQuery para cerrar el modal (asegúrate de que esté cargado)
		        if (typeof $ !== 'undefined') {
		            $('#editEventModal').modal('hide');
		        } else {
		            console.warn('jQuery no está definido, intentando cerrar modal sin jQuery');
		            const modal = document.getElementById('editEventModal');
		            const bootstrapModal = bootstrap.Modal.getInstance(modal);
		            if (bootstrapModal) bootstrapModal.hide();
		        }
		        loadEvents(); // Recargar la lista de eventos
		    } catch (error) {
		        console.error('Error al actualizar el evento:', error);
		        alert('Error al actualizar el evento: ' + error.message);
		    }
		});

        async function deleteEvent(id) {
            if (confirm(`¿Estás seguro de eliminar el evento con ID: ${id}?`)) {
                try {
                    const response = await fetch(`/rest/organizadores/eventos/${id}`, {
                        method: 'DELETE',
                        headers: { 'Content-Type': 'application/json' },
                        credentials: 'include',
                    });

                    if (response.ok) {
                        alert('Evento eliminado exitosamente.');
                        loadEvents();
                    } else {
                        const result = await response.json();
                        alert(result.message || 'Error al eliminar el evento');
                    }
                } catch (error) {
                    alert('Error de conexión: ' + error.message);
                    console.error('Error:', error);
                }
            }
        }

        window.onload = async () => {
            await loadResources();
            await loadEvents();
        };
    </script>
</body>
</html>